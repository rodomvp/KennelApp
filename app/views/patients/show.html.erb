<% provide(:title, "PATIENT: #{@patient.name} the #{@patient.breed}")  %>

<!-- Header with Keybindings -->
<h1>
  <%= link_to @patient.previous, data: { keybinding: '["h", "left"]' },
          class: "btn" do %>
      <i class="glyphicon glyphicon-menu-left"></i>
  <% end %>
  <%= "#{@patient.name} the #{@patient.breed}" %>
  <%= link_to @patient.next, data: { keybinding: '["l", "right"]' },
          class: "btn" do %>
      <i class="glyphicon glyphicon-menu-right"></i>
  <% end %>
</h1>

<!-- Check In and Check Out Buttons -->
<div class="patient-container">
  <div style="float: right">
    <% if @patient.has_current_stay? %>
      <%= link_to "Check Out", @patient.current_stay, method: :delete,
              class: "btn btn-lg btn-danger", :style=>"margin: 10px;" %>
    <% else %>
      <%= link_to "Check In", new_stay_path, class: "btn btn-lg btn-primary", 
              :style=>"margin: 10px;" %>
    <% end %>
  </div>

<!-- Edit Button -->
  <div style="float: right; position: relative;">
      <%= link_to 'Edit <i class="glyphicon glyphicon-pencil"></i>'.html_safe, edit_patient_path, class: "btn btn-lg btn-primary", :style=>"margin: 10px;" %>
  </div>

<!-- Patient Profile Information -->
  <!-- Patient Picture -->
  <% if @patient.image_url(:thumb).present? %>
    <% patient_image_url = @patient.image_url(:thumb).to_s %>
  <% else %>
   <% patient_image_url = 'genericdoghead.png' %>
  <% end %>
  <%= image_tag patient_image_url, height: '150',
            :style=>"margin: 10px; float: left;" %> 
  <!-- Owner Link --> 
  <h5>Belongs to 
    <%= link_to "#{@patient.owner.first_name} #{@patient.owner.last_name}", @patient.owner %>
  </h5>
  <h6><%= "Weight : " "#{@patient.weight}" %></h6>
  <h6><%= "Diet : " "#{@patient.diet}" %></h6>
  <!-- Stay -->
  <% if @patient.stays.length > 0 %>
  <!-- Run Link -->
  <h5 style="margin-top:20px;"> Stay : <span class="label label-pill label-info" style="position: relative; background: #4682b4; left: 8px;"><%= link_to "#{@patient.current_stay.runn.ident}", @patient.current_stay.runn, :style=>"color: #eee; font-size: 9pt;" %></span></h5>
  <h6 style="margin-top: 12px;">
    Check in Time : 
    <% t = @patient.current_stay.created_at %>
    <%= t.in_time_zone('Central Time (US & Canada)').strftime("%B %d, %Y at %l:%M %p") %>
  </h6>
  <!-- NPO checkbox -->
  <% if @patient.npo? %>
    <h6 style="color: red">NPO<h6>
  <% end %>
  <% end %>
</div>




<!-- Checked in Patient Elements -->
<% if @patient.has_current_stay? %>
<br>
<!-- U/D Chart -->
<div class="patient-container" style="display: inline-block; width: 100%; height: 240px;">
  <center>
  <h3 style="margin: 10px;">U/D Chart</h3>
  <table style="color: #152736; margin: 10px;" >
    <!-- TODO form_for -->
    <!-- Reference: http://guides.rubyonrails.org/form_helpers.html#the-select-and-option-tags -->
    <!-- <%= select(:UDEvent, :U1, [['Normal', 1], ['None', 2], ['Abnormal',3]]) %> -->
    <tr>
        <th style="visibility: hidden"></th>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
    </tr>
    <tr>
        <th>U</th>
        <td><select name="U1">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="U2">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="U3">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="U4">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
    </tr>
    <tr>
        <th>D</th>
        <td><select name="D1">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="D2">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="D3">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
        <td><select name="D4">
          <option value="">      </option>
          <option value="normal">Normal</option>
          <option value="none">None</option>
          <option value="abnormal">Abnormal</option>
          </select>
        </td>
    </tr>
  </table>
   <input TYPE="submit" VALUE="Save Changes">
  </center>
</div>
<!-- Medical Notes -->
<div class="patient-container" style="display: inline-block; width: 100%; margin: 1px;">
  <center>
  <h3 style="margin: 10px;">Medical Notes</h3>
  

      <section class="note_form">
        <%= render 'notes/form' %>
      </section>
 

<div class="row">
  <div class="col-md-8">
    <% if @patient.notes.any? %>
      <h3>notes (<%= @patient.notes.count %>)</h3>
      <ol class="notes">
        <%= render @notes %>
      </ol>
      <%= will_paginate @notes %>
    <% end %>
  </div>
</div>
</center>
</div>
<% end %>

<!-- Extra Keybindings -->
<%= link_to '', all_patients_path, data: { keybinding: [ 'b', 'k', 'up' ]} %>

<!-- Debug -->
<div style="float: bottom;">
<p><i>## -- Some debugging info below ------------- ##</i></p>
  <p>has_current_stay?: [<%= @patient.has_current_stay? %>]</p>
  <p>current_stay: [<%= if @patient.current_stay then link_to "#{@patient.current_stay.id}", @patient.current_stay end %>]</p>
  <p>current_runn: [<%= if @patient.current_stay then link_to "#{@patient.current_runn.ident}", @patient.current_runn end %>]</p>
</div>
